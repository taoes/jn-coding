---
title: 经典架构设计的分析
date: 2020-04-29 22:54:01
tags: 架构
author: 江南
categories: 系统架构
urlName: five_system_article
---
系统架构的重要性已经不言而喻，一个良好的架构好比一栋摩天大厦的基础结构，架构选型的正确是保证大厦稳定的根本。而系统构架是对已确定的需求的技术实现构架、作好规划，运用成套、完整的工具，在规划的步骤下去完成任务。抽象来说，它是计算机系统结构，或称计算机体系结构，是一个系统在其所处环境中最高层次的概念；

系统架构目前有多重多样，下面列举了一些常见的架构设计，本文将对这几种常见的设计做出分析与讨论。

<!--more-->

分层架构是一种非常常见的架构设计模式，有时候也称之为N层架构模式。这种设计模式是大多数JavaWeb项目的标准，因为了解此交架构的人特别多，所以这也成为大多数设计模式的首选。

## 1、模式分析

在分层架构中，代码被划分为若干个层，每个层之间代表了一个功能或者逻辑。大多数JavaEE项目将项目划分为三层或者四层，比如展示层、业务层、持久化层以及数据库层(在前后端分离的项目中，展示层交给了前端项目，此时展示层承担数据传输的角色，也可以改称为接口层)，有些时候业务层会和持久化层合并，转化为三层结构：称之为展示层、服务层、数据库层。当然具体的层数划分并没有限制，可以根据项目的结构和大小来作出衡量。但需要注意的是，每个层锁承担的职能需要明确的划分，比如展示层负责处理页面的渲染，交互等逻辑；业务层负责处理相应的业务逻辑；持久化层负责数据的持久化操作；数据库层负责数据的CURD以及SQL的执行等等。各个层之间并不在乎数据的来源，比如业务层并不在乎数据是来自用户的请求还是单元测试，业务层获取数据时候，也并不需要知道数据是来自Redis还是MySQL。分层架构的一个明显的优点就在于能够很好的进行组件之间的关注点分离，一个组件制度则自己的逻辑实现。有了组件分离，应用才能更好地进行测试，管理和维护。

![分层架构模型图](https://pic.zhoutao123.com/2021/11/layer.png)

## 2、关键概念

上图中展示的是经典的4层架构设计，可以观察到每一层之间都对其上层开放，比如持久化层只对业务层开发，对展示层关闭。这意味着一个请求必须完整的从展示层到业务层，最后达到数据库层。那么刚开始开发的读者可能就会有个疑问，为什么不让展示层直接访问数据库层呢，这样代码不更少吗？事实上涉及到一个概念-层隔离。


### 2.1 层隔离
上面的文章中也涉及到了层隔离的概念。所谓的层隔离指的是，架构中某一个层的改变不会影响想到其他层，这些改变仅仅限制于当前层次。假如数据库层的SQL修改了，势必会影响到持久化层和展示层。这只会让各层之间仅仅耦合在一起，非常难以维护。同时，各层分离也会使得更加方便的维护和重构。想想一个场景，将展示层的业务JSP修改为FreeMarker，假设展示层和业务层保持一致，那么展示层的修改是不会涉及到业务层以及持久化层的。

### 2.2  层的开放与关闭

假设我们将业务层的某些方法抽象为新的一层，称之为服务层。那么服务层处于业务层之下，持久化层之上。根据分层架构的模式。业务层只能访问服务层然后再访问持久化层，这样很不合理。因此我们可以设置某一些层开放，让这层可以供服务层和业务层调用，如下图，开放了服务层，使得业务层可以直接跳过服务层访问到持久化层。

![分层的开放](https://pic.zhoutao123.com/2021/11/layer-open.png)


### 2.3 污水池反模式
假设我们尚未开放服务层，那么业务层对持久化层的访问，必须经过服务层，但是这种访问在服务层不会做任何的处理，仅仅就是一个简单的转发。每个分层就够都会遇到这种问题，一般分层架构的层数越多这种现象就越多。所以我们可以适当的开放一些层，使得其他层可以跳过此层，避免大量这样的代码出现，具体的开放标准，可以根据经典的2-8准则，当此层的方法超过20%都是污水池反模式的话，就可以尝试开放此层，避免这种模式的出现。



## 2、模式分析总结

- 整体灵活性较低，应对改变也很难作出及时的修改，分层的笨重以及层与层之间的耦合是导致灵活性降低的主要原因。
- 不易部署和拓展，一个小小的变动，都需要重新的修改对整个项目打包，部署，较为麻烦；同时系统中某个功能需要拓展的话也需要整个应用一起拓展。
- 性能较低，因为一个简单的请求几乎要穿过所有的层之后才能完成，因此这种模式会带来性能上的损耗。
- 可测试性比较高，得益于各个层之间的隔离，我们可以对各个层之间比较方便的进行测试。
- 分层模式由于被众多开发者和架构师所熟知，因此这种模式容易开发，对于大部分商业系统都很适合。


## 3、参考资料
+  《软件架构模式-Software Architecture Patterns》 Mark Richards 著

